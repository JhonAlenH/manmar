<!-- Header -->
<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8">
    <div class="container-fluid">
      <div class="header-body">
        <!-- Card stats -->
        <div class="row">
          <!-- Aquí podrías agregar tarjetas de estadísticas si lo necesitas -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Container principal -->
  <div class="container-fluid">
    <!-- Row principal -->
    <div class="row">
      <div class="col">
        <!-- Card principal -->
        <div class="card shadow hola">
          <div class="card-body">
            <!-- Formulario de filtros -->
            <form [formGroup]="administrativeForm" style="position: relative; z-index: 1000;">
              <div class="row py-3">
                <div class="col-sm-12">
                  <mat-accordion class="example-headers-align expansion_notificacion" multi>
                    <mat-expansion-panel>
                      <mat-expansion-panel-header style="background-color: #6f86e3;">
                        <mat-panel-title style="font-weight: 500; color: aliceblue;">
                          Filtros Adicionales de Búsqueda
                        </mat-panel-title>
                      </mat-expansion-panel-header>
  
                      <div class="row justify-content-center mt-3">
                        <div class="col-md-4">
                          <mat-form-field class="example-full-width">
                            <mat-label>Cedentes</mat-label>
                            <input type="text"
                                   placeholder="Seleccione Cedentes"
                                   aria-label="Seleccione"
                                   matInput
                                   [formControl]="cedentsControl"
                                   [matAutocomplete]="cedents"
                                   formControlName="xcedente"
                                   required>
                            <mat-autocomplete #cedents="matAutocomplete">
                              <mat-option *ngFor="let cedent of filteredCedents | async" [value]="cedent">
                                {{ cedent }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </div>
                        <div class="col-md-4">
                          <mat-form-field class="example-full-width">
                            <mat-label>Ramo</mat-label>
                            <input type="text"
                                   placeholder="Seleccione Ramo"
                                   aria-label="Seleccione"
                                   matInput
                                   [formControl]="tradeControl"
                                   [matAutocomplete]="trade"
                                   required>
                            <mat-autocomplete #trade="matAutocomplete" (optionSelected)="onTradeSelection($event)">
                              <mat-option *ngFor="let trade of filteredTrade | async" [value]="trade">
                                {{ trade }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </div>
                      </div>
                    </mat-expansion-panel>
                  </mat-accordion>
                </div>
              </div>
            </form>

            <mat-tab-group>
              <mat-tab label="Comisiones por Cobrar">
                <div class="d-flex py-4">
                  <div class="col-sm-12">
                    <mat-accordion>
                      <mat-expansion-panel *ngFor="let cedente of uniqueCedentes" style="background: #6f86e3;;" (opened)="onPanelOpen(cedente.ccedente, 'Todas')">
                        <mat-expansion-panel-header>
                          <mat-panel-title style="font-weight: 500; color: aliceblue;">
                            {{ cedente.xcedente }}
                          </mat-panel-title>
                        </mat-expansion-panel-header>

                        <div class="row">
                          <div class="col-md-4">
                            <mat-button-toggle-group 
                              name="fontStyle" 
                              aria-label="Font Style"
                              [value]="getDefaultToggleValue(cedente)"
                              (change)="onToggleChange($event.value, cedente)"
                            >
                              <mat-button-toggle value="bruto">Monto Bruto</mat-button-toggle>
                              <mat-button-toggle value="neto">Monto Neto</mat-button-toggle>
                            </mat-button-toggle-group>
                          </div>
                          <div class="col-md-4">
                            <div class="dropdown">
                              <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Tipo de Comisiones
                              </button>
                              <ul class="dropdown-menu">
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Vencidas')">Vencidas</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Vigentes')">Vigentes</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Próximas')">Próximas</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Todas')">Todas</a></li>
                              </ul>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="w-70">
                              <input type="text" class="form-control" placeholder="Buscar..." (input)="filterSeguimientosData($event.target.value)">
                            </div>           
                          </div>
                        </div>

                        <div class="table-responsive">

                          <table class="table table-striped custom-table">
                            <thead>
                              <tr>
                                <th>Póliza</th>
                                <th>Asegurado</th>
                                <th>Fecha Desde</th>
                                <th>Fecha Hasta</th>
                                <th>Monto Neto $</th>
                                <th>Monto Neto Bs.</th>
                                <th>Abono</th>
                                <th>
                                  <input type="checkbox" [(ngModel)]="selectAll" (change)="toggleSelectAll()" />
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let item of paginatedList">
                                <td>{{ item.xpoliza }}</td>
                                <td>{{ item.xnombre }}</td>
                                <td>{{ item.fdesde_rec | date }}</td>
                                <td>{{ item.fhasta_rec | date }}</td>
                                <td style="padding: 0.4rem;">
                                  <input type="number" [(ngModel)]="item.mneto" class="custom-input" (ngModelChange)="updateMnetobs(item)">
                                </td>
                                <td style="padding: 0.4rem;">
                                  <input type="number" [(ngModel)]="item.mnetobs" class="custom-input">
                                </td>
                                <td>
                                  <button class="btn btn-primary btn-sm custom-small-button" (click)="abonar(item)">Abonar</button>
                                </td>
                                <td>
                                  <input type="checkbox" [(ngModel)]="item.selected" (change)="onItemSelect(item)" />
                                </td>
                              </tr>
                            </tbody>
                          </table>

                          <div class="d-flex justify-content-center mt-4">
                            <ngb-pagination
                            *ngIf="receipt.length > 0"
                            [collectionSize]="receipt.length"
                            [(page)]="pageReceipt"
                            [pageSize]="pageReceiptSize"
                            [maxSize]="1"
                            [previousLabel]="'‹'"
                            [nextLabel]="'›'"
                            [boundaryLinks]="true"
                            [ellipses]="false"
                            (pageChange)="onPageChange()"
                          ></ngb-pagination>
                          </div>
                        </div>
                    
                      </mat-expansion-panel>
                    </mat-accordion>         
                  </div>

                </div>
              </mat-tab>
              <mat-tab label="Ingresar Complementos">
                <div class="d-flex py-4">
                  <div class="col-sm-12">
                    <mat-accordion>
                      <mat-expansion-panel *ngFor="let cedente of uniqueCedentesFee" style="background: #6f86e3;;" (opened)="onPanelOpen2(cedente.ccedente)">
                        <mat-expansion-panel-header>
                          <mat-panel-title style="font-weight: 500; color: aliceblue;">
                            {{ cedente.xcedente }}
                          </mat-panel-title>
                        </mat-expansion-panel-header>

                        <!-- <div class="col-md-6 mx-auto py-3">
                          <div class="w-70">
                            <input type="text" class="form-control" placeholder="Buscar..." (input)="filterComplementosData($event.target.value)">
                          </div>           
                        </div> -->

                        <mat-form-field>
                          <mat-label>Filter</mat-label>
                          <input matInput (keyup)="applyFilter($event)" placeholder="Ex. ium" #input>
                        </mat-form-field>

                        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort multiTemplateDataRows>
                          <!-- Columna Crámo -->
                          <ng-container [matColumnDef]="column" *ngFor="let column of columnsToDisplay; let i = index">
                            <th mat-header-cell *matHeaderCellDef> {{ columnsName[i] }} </th>
                            <td mat-cell *matCellDef="let element"> {{ element[column] }} </td>
                          </ng-container>
                        
                          <ng-container matColumnDef="expand">
                            <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
                            <td mat-cell *matCellDef="let element">
                              <button mat-button (click)="toggleRow(element)">
                                <mat-icon *ngIf="expandedElement !== element">keyboard_arrow_down</mat-icon>
                                <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
                              </button>
                            </td>
                          </ng-container>
                        
                          <ng-container matColumnDef="expandedDetail">
                            <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length" style="background: aliceblue;">
                              <div class="example-element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                <div class="expanded-element-detail">
                                  <table class="details-table">
                                    <tr *ngIf="currentRecordComplements[element.id]?.length > 0">
                                      <ng-container *ngFor="let column of columnsNameDetail">
                                        <th>{{ column }}</th>
                                      </ng-container>
                                    </tr>
                        
                                    <ng-container *ngIf="currentRecordComplements[element.id]?.length > 0; else noData">
                                      <tr *ngFor="let detail of currentRecordComplements[element.id]">
                                        <td>{{ detail.fmovimiento }}</td>
                                        <td>{{ detail.mpagado }}</td>
                                        <td>
                                          <a *ngIf="detail.xruta_tipomov" [href]="detail.xruta_tipomov" target="_blank">
                                            Ver comprobante
                                          </a>
                                        </td>
                                      </tr>
                                    </ng-container>
                        
                                    <ng-template #noData>
                                      <tr>
                                        <td colspan="3" class="text-center">No se ha encontrado complementos</td>
                                      </tr>
                                      <tr>
                                        <td colspan="3" class="text-center">
                                          <button mat-button color="primary" (click)="addComplement(element)">Agregar</button>
                                        </td>
                                      </tr>
                                    </ng-template>
                                  </table>
                                </div>
                              </div>
                            </td>
                          </ng-container>
                        
                          <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
                          <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;"
                              class="example-element-row" [class.example-expanded-row]="expandedElement === element"
                              (click)="toggleRow(element)">
                          </tr>
                          <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
                        </table>
                        

                        <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="5"></mat-paginator>
                    
                      </mat-expansion-panel>
                    </mat-accordion>     
                  </div>

                </div>
              </mat-tab>
              <mat-tab label="Gestionar Distribución de Comisiones">
                <form [formGroup]="commisionsForm">
                  <div class="d-flex py-4">
                    
                      <div class="col-md-4">
                        <h5 class="text-center"><strong>Fecha Desde</strong></h5>
                        <div>
                          <input type="date" formControlName="fdesde" class="custom-input" (change)="calcularFechaHasta()">
                        </div>
                      </div>
                      <div class="col-md-4">
                        <h5 class="text-center"><strong>Fecha Hasta</strong></h5>
                        <div>
                          <input type="date" formControlName="fhasta" class="custom-input" >
                        </div>
                      </div>  
                      <div class="col-md-4">
                        <h5 class="text-center"><strong>Cedentes</strong></h5>
                        <div>
                          <mat-form-field class="example-full-width">
                            <mat-select disableRipple #cedenteSelect (selectionChange)="searchDistributions(cedenteSelect.value)">
                              <mat-option *ngFor="let cedente of uniqueCedentesFee" [value]="cedente.ccedente">{{cedente.xcedente}}</mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>  
                  </div>

                  
                    <!-- Sección de Productores -->
                    <div class="d-flex" *ngIf="this.distributionList.length > 0">
                      <div class="col-sm-12">
                        <h3>Productores</h3>

                        <h3 *ngIf="this.productores.length > 0">
                          <strong *ngFor="let productor of productores">
                            {{productor.xproductor}} - Total Comisión: {{productor.mcomision_pext | currency}} | {{productor.mcomision_p}} Bs.
                          </strong>
                        </h3>

                      </div>
                    </div>
                  
                    <!-- Sección de Ejecutivos -->
                    <div class="d-flex" *ngIf="this.distributionList.length > 0">
                      <div class="col-sm-12 py-3">
                        <h3>Ejecutivos</h3>

                        <h3 *ngIf="this.ejecutivos.length === 0">
                          <strong>
                            No se encontraron Ejecutivos según los parametros seleccionados
                          </strong>
                        </h3>


                        <div class="executives-grid">
                          <mat-accordion *ngFor="let ejecutivo of ejecutivos" [multi]="false">
                            <mat-expansion-panel>
                              <mat-expansion-panel-header>
                                <mat-panel-title>
                                  {{ejecutivo.xejecutivo}} - Total Comisión: {{ejecutivo.mcomision_eext | currency}}
                                </mat-panel-title>
                              </mat-expansion-panel-header>
                    
                              <!-- Información adicional del ejecutivo -->
                              <div>
                                <!-- Acciones -->
                                <h4 class="text-center" style="font-weight: 500;">Acciones</h4>
                    
                                <!-- Botones de acción -->
                                <div class="d-flex justify-content-center mt-3">
                                  <!-- Botón Detalles -->
                                  <button type="button" class="btn btn-secondary btn-sm custom-small-button" 
                                          matTooltip="Detalles de {{ejecutivo.xejecutivo}}" 
                                          (click)="verDetallesEjecutivo(ejecutivo.cejecutivo)">
                                    <i class="fi fi-br-file-circle-info"></i>
                                  </button>
                    
                                  <!-- Botón Pagar -->
                                  <button type="button" class="btn btn-secondary btn-sm custom-small-button" 
                                          matTooltip="Pagar a {{ejecutivo.xejecutivo}}" 
                                          (click)="pagarEjecutivo(ejecutivo.cejecutivo, ejecutivo.mcomision_e)">
                                    <i class="fi fi-ss-expense"></i>
                                  </button>
                                </div>
                              </div>
                            </mat-expansion-panel>
                          </mat-accordion>
                        </div>
                      </div>
                    </div>
                  
                                    
                    <!-- Sección de Agentes -->
                    <div class="d-flex" *ngIf="this.distributionList.length > 0">
                      <div class="col-sm-12 py-3">
                        <h3>Agentes</h3>

                        <h3 *ngIf="this.agentes.length === 0">
                          <strong>
                            No se encontraron Agentes según los parametros seleccionados
                          </strong>
                        </h3>


                        <div class="executives-grid">
                          <mat-accordion *ngFor="let agente of agentes" [multi]="false">
                            <mat-expansion-panel>
                              <mat-expansion-panel-header>
                                <mat-panel-title>
                                  {{agente.xagente}} - Total Comisión: {{agente.mcomision_aext | currency}}
                                </mat-panel-title>
                              </mat-expansion-panel-header>
                    
                              <!-- Información adicional del agente -->
                              <div>
                                <!-- Acciones -->
                                <h4 class="text-center" style="font-weight: 500;">Acciones</h4>
                    
                                <!-- Botones de acción -->
                                <div class="d-flex justify-content-center mt-3">
                                  <!-- Botón Detalles -->
                                  <button type="button" class="btn btn-secondary btn-sm custom-small-button" 
                                          matTooltip="Detalles de {{agente.xagente}}" 
                                          (click)="verDetallesAgente(agente.cagente)">
                                    <i class="fi fi-br-file-circle-info"></i>
                                  </button>
                    
                                  <!-- Botón Pagar -->
                                  <button type="button" class="btn btn-secondary btn-sm custom-small-button" 
                                          matTooltip="Pagar a {{agente.xagente}}" 
                                          (click)="pagarAgente(agente.cagente, agente.mcomision_a)">
                                    <i class="fi fi-ss-expense"></i>
                                  </button>
                                </div>
                              </div>
                            </mat-expansion-panel>
                          </mat-accordion>
                        </div>
                      </div>
                    </div>
                </form>
              </mat-tab>
            </mat-tab-group>


          </div> 
        </div> 
      </div> 
    </div> 
  </div> 

  <button
    class="btn-flotante btn-flotante-2" 
    mat-raised-button
    style="background: #6f86e3;" 
    *ngIf="amount"
    [matMenuTriggerFor]="menu"
    >
    <div class="d-flex" style="gap: 15px;margin-top: 10px;">
      <i class= "fi fi-rs-coins" style="font-size: 20px;color: white;"></i>
      <p style="color: white;font-weight: 500;">Monto Total: {{totalMontoNeto}} {{simbolo}}</p>
    </div>
    
  </button>

  <mat-menu #menu="matMenu" xPosition="after">
    <form style="min-width: 500px;"  [formGroup]="administrativeForm" (click)="$event.stopPropagation()">
      <div class="col-sm-12">
        <mat-form-field class="example-full-width">
          <mat-label>Banco</mat-label>
          <input type="text"
                 placeholder="Seleccione Banco"
                 aria-label="Seleccione"
                 matInput
                 [formControl]="bankControl"
                 [matAutocomplete]="bank"
                 >
          <mat-autocomplete #bank="matAutocomplete" (optionSelected)="onBankSelection($event)">
            <mat-option *ngFor="let bank of filteredBank | async" 
                        [value]="bank"
                        (click)="$event.stopPropagation()">
              {{ bank }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>

      <div class="col-sm-12">
        <mat-form-field class="example-full-width">
          <mat-label>Referencia</mat-label>
          <input matInput placeholder="(Últimos 6 dígitos)" maxlength="6" formControlName="xreferencia" type="text" (change)="validateCobro()">
        </mat-form-field>
      </div>

      <div class="d-flex justify-content-center">
        <button
        mat-raised-button
        style="background: #6f86e3;" 
        (click)="validateCobro()"
        >
        <div class="d-flex" style="gap: 15px;margin-top: 10px;">
          <i class= "fi fi-ss-deposit-alt" style="font-size: 20px;color: white;"></i>
          <p style="color: white;font-weight: 500;">Aceptar</p>
        </div>
        
      </button>
      </div>

    </form>
  </mat-menu>

  <ng-template #Complemento let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
      <h2 style="font-weight: 500;">Complementos</h2>
    </div>
    <mat-divider class="my-3"></mat-divider>
    <mat-dialog-content>
      <!-- <hr style="background: black;"> -->
      <div class="row">
        <div class="col-md-12 ">
          <form [formGroup]="administrativeForm">
            <div class="row">
              <div class="col-md-4">
                <h5 class="text-center"><strong>Fecha Complemento</strong></h5>
                <div>
                  <input type="date" formControlName="fcomplemento" class="custom-input">
                </div>
              </div>
              <div class="col-md-4">
                <h5 class="text-center"><strong>Moneda</strong></h5>
                <mat-form-field class="example-full-width">
                  <mat-select formControlName="cmoneda_comp">
                    <mat-option *ngFor="let coin of coinsList" [value]="coin.id">{{coin.value}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-md-4">
                <h5 class="text-center"><strong>Monto del Complemento</strong></h5>
                <mat-form-field class="example-full-width">
                  <input matInput formControlName="mcomplemento" type="text" (input)="formatPrima($event)" (change)="changeTasaComplemento()">
                </mat-form-field>
                <h5 *ngIf="this.montoTransformado > 0">Monto en {{simbolo}}: {{montoTransformado}}</h5>
              </div>
            </div>

            <div class="d-flex justify-content-center py-2">
              <button class="btn btn-primary btn-sm" style="background: #6f86e3;" (click)="validateComplement()">
                Aceptar
              </button>
            </div>
          </form>

        </div>

      </div>
    </mat-dialog-content>
  </ng-template>

  <ng-template #Abonar let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
     <label>Abonos</label>
    </div>
    <mat-divider></mat-divider>
    <mat-dialog-content>
      <form [formGroup]="administrativeForm">
        <table class="table custom-table">
          <thead>
            <tr>
              <th>Fecha de Abono</th>
              <th>Moneda</th>
              <th>Monto de Abono</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let abono of abonosList">
              <td style="padding: 1.4rem;">
                <!-- Mostrar la fecha formateada como texto -->
                <span>{{ abono.fmovimiento }}</span>
              </td>
              <td style="padding: 1.4rem;">
                <span>{{ abono.moneda }}</span>
              </td>
              <td style="padding: 1.4rem;">
                <span>{{ abono.mpagado }}</span>
              </td>
              <td style="padding: 1.4rem;">
                <a *ngIf="abono.xruta_tipomov" [href]="abono.xruta_tipomov" target="_blank">
                  Ver comprobante
                </a>
              </td>
            </tr>
            <!-- Fila adicional para nuevo abono -->
            <tr>
              <td style="padding: 0.4rem;">
                <input 
                  type="date" 
                  formControlName="fabono"
                  class="custom-input" />
              </td>
              <td style="padding: 0.8rem;">
                <mat-form-field class="example-full-width">
                  <mat-select formControlName="cmoneda_abono">
                    <mat-option *ngFor="let coin of coinsList" [value]="coin.id">{{coin.value}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
              <td style="padding: 0.4rem;">
                <input 
                  type="text" 
                  formControlName="mpagado_abono" 
                  class="custom-input " 
                  (change)="validarNuevoAbono()"
                  />
                  <h5 *ngIf="this.montoTransformado > 0">Monto en {{simbolo}}: {{montoTransformado}}</h5>
              </td>
            </tr>
          </tbody>
        </table>
      </form>

      <div class="text-end w-100">
        <button class="btn btn-primary btn-sm" (click)="calcularAbonoRestante()" *ngIf="abonosList.length > 0">Calcular Restante</button>
        <button class="btn btn-primary btn-sm" (click)="guardarNuevoAbono()">Aceptar</button>
      </div>

      <div class="d-flex justify-content-center">
        <p><strong>Neto en Bs: </strong>{{netoBs}}</p>
      </div>
      
    
    </mat-dialog-content>
  </ng-template> 

  <ng-template #DetalleProductor let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
      <h2 style="font-weight: 500;">Detalle del Productor</h2>
    </div>
    <mat-divider class="my-3"></mat-divider>
    <mat-dialog-content>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Productor</th>
            <th>Comisión</th>
            <th>Tipo Movimiento</th>
            <th>Fecha Movimiento</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of detalleProductores">
            <td>{{item.xproductor}}</td>
            <td>{{item.mcomision_p}} Bs.</td>
            <td>{{getTipoMovimiento(item.itipomov)}}</td>
            <td>{{item.fmovimiento | date}}</td>
          </tr>
        </tbody>
      </table>
    </mat-dialog-content>
  </ng-template>

  <ng-template #DetalleEjecutivo let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
      <h2 style="font-weight: 500;">Detalle del Ejecutivo</h2>
    </div>
    <mat-divider class="my-3"></mat-divider>
    <mat-dialog-content>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Cedente</th>
            <th>Tomador</th>
            <th>Póliza</th>
            <th>N° Recibo</th>
            <th>Comisión Bs.</th>
            <th>Comisión $.</th>
            <th>Tipo Movimiento</th>
            <th>Fecha Movimiento</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of detalleEjecutivos">
            <td>{{item.xcedente}}</td>
            <td>{{item.xtomador}}</td>
            <td>{{item.xpoliza}}</td>
            <td>{{item.crecibo}}</td>
            <td>{{item.mcomision_e}} Bs.</td>
            <td>{{item.mcomision_eext}} $.</td>
            <td>{{getTipoMovimiento(item.itipomov)}}</td>
            <td>{{item.fmovimiento | date}}</td>
          </tr>
        </tbody>
      </table>
    </mat-dialog-content>
  </ng-template>

  <ng-template #DetalleAgente let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
      <h2 style="font-weight: 500;">Detalle del Agente</h2>
    </div>
    <mat-divider class="my-3"></mat-divider>
    <mat-dialog-content>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Cedente</th>
            <th>Tomador</th>
            <th>Póliza</th>
            <th>N° Recibo</th>
            <th>Comisión Bs.</th>
            <th>Comisión $.</th>
            <th>Tipo Movimiento</th>
            <th>Fecha Movimiento</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of detalleAgentes">
            <td>{{item.xcedente}}</td>
            <td>{{item.xtomador}}</td>
            <td>{{item.xpoliza}}</td>
            <td>{{item.crecibo}}</td>
            <td>{{item.mcomision_a}} Bs.</td>
            <td>{{item.mcomision_aext}} $.</td>
            <td>{{getTipoMovimiento(item.itipomov)}}</td>
            <td>{{item.fmovimiento | date}}</td>
          </tr>
        </tbody>
      </table>
    </mat-dialog-content>
  </ng-template>

  <ng-template #PagarProductor let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
     <label>Pago al Productor</label>
    </div>
    <mat-divider></mat-divider>
    <mat-dialog-content style="display: contents;">
      <form [formGroup]="commisionsForm">
        <div class="row py-3">
          <div class="col-sm-5 py-3">
            <mat-form-field class="example-full-width">
              <mat-label>Banco</mat-label>
              <input type="text"
                    placeholder="Seleccione Banco"
                    aria-label="Seleccione"
                    matInput
                    [formControl]="bankControl"
                    [matAutocomplete]="bank"
                    >
              <mat-autocomplete #bank="matAutocomplete" (optionSelected)="onBankSelectionProductor($event)">
                <mat-option *ngFor="let bank of filteredBank | async" [value]="bank">
                  {{ bank }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <div class="col-sm-7">
            <div class="input-group py-3">
              <button type="button" class="btn ">{{ moneda }}</button>
              <button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="visually-hidden">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-start">
                <li *ngFor="let coin of coinsList">
                  <button class="dropdown-item" (click)="coinSelectProductor(coin.id)">{{ coin.value }}</button>
                </li>
              </ul>
              <input placeholder="  Ingrese Monto" class="form-control" formControlName="mmonto_p" type="text" (input)="formatPrima($event)">
            </div>
          </div>

        </div>

        <div class="row">
          <div class="col-sm-5">
            <h5 class="text-center"><strong>Fecha de Pago</strong></h5>
            <div>
              <input type="date" formControlName="fpago_p" class="custom-input" style="padding: 5px 5px;">
            </div>
          </div>
          <div class="col-sm-7 py-4">
            <mat-form-field class="example-full-width">
              <mat-label>Referencia</mat-label>
              <input matInput placeholder="(Últimos 6 dígitos)" maxlength="6" formControlName="xreferencia_p" type="text">
            </mat-form-field>
          </div>
        </div>

        <div class="text-end w-100">
          <button class="btn btn-primary btn-sm" (click)="guardarPagoProductor()">Aceptar</button>
        </div>

      </form>
    </mat-dialog-content>
  </ng-template> 

  <ng-template #PagarEjecutivo let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
     <label>Pago al Ejecutivo</label>
    </div>
    <mat-divider></mat-divider>
    <mat-dialog-content style="display: contents;">
      <form [formGroup]="commisionsForm">
        <div class="row py-3">
          <div class="col-sm-5 py-3">
            <mat-form-field class="example-full-width">
              <mat-label>Banco</mat-label>
              <input type="text"
                    placeholder="Seleccione Banco"
                    aria-label="Seleccione"
                    matInput
                    [formControl]="bankControl"
                    [matAutocomplete]="bank"
                    >
              <mat-autocomplete #bank="matAutocomplete" (optionSelected)="onBankSelectionEjecutivo($event)">
                <mat-option *ngFor="let bank of filteredBank | async" [value]="bank">
                  {{ bank }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <div class="col-sm-7">
            <div class="input-group py-3">
              <button type="button" class="btn ">{{ moneda }}</button>
              <button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="visually-hidden">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-start">
                <li *ngFor="let coin of coinsList">
                  <button class="dropdown-item" (click)="coinSelectEjecutivo(coin.id)">{{ coin.value }}</button>
                </li>
              </ul>
              <input placeholder="  Ingrese Monto" class="form-control" formControlName="mmonto_e" type="text" (input)="formatPrima($event)">
            </div>
          </div>

        </div>

        <div class="row">
          <div class="col-sm-5">
            <h5 class="text-center"><strong>Fecha de Pago</strong></h5>
            <div>
              <input type="date" formControlName="fpago_e" class="custom-input" style="padding: 5px 5px;">
            </div>
          </div>
          <div class="col-sm-7 py-4">
            <mat-form-field class="example-full-width">
              <mat-label>Referencia</mat-label>
              <input matInput placeholder="(Últimos 6 dígitos)" maxlength="6" formControlName="xreferencia_e" type="text">
            </mat-form-field>
          </div>
        </div>

        <div class="text-end w-100">
          <button class="btn btn-primary btn-sm" (click)="guardarPagoEjecutivo()">Aceptar</button>
        </div>

      </form>
    </mat-dialog-content>
  </ng-template> 

  <ng-template #PagarAgente let-dialogRef="dialogRef">
    <div mat-dialog-title class="d-flex justify-content-between align-items-center">
     <label>Pago al Agente</label>
    </div>
    <mat-divider></mat-divider>
    <mat-dialog-content style="display: contents;">
      <form [formGroup]="commisionsForm">
        <div class="row py-3">
          <div class="col-sm-5 py-3">
            <mat-form-field class="example-full-width">
              <mat-label>Banco</mat-label>
              <input type="text"
                    placeholder="Seleccione Banco"
                    aria-label="Seleccione"
                    matInput
                    [formControl]="bankControl"
                    [matAutocomplete]="bank"
                    >
              <mat-autocomplete #bank="matAutocomplete" (optionSelected)="onBankSelectionAgente($event)">
                <mat-option *ngFor="let bank of filteredBank | async" [value]="bank">
                  {{ bank }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <div class="col-sm-7">
            <div class="input-group py-3">
              <button type="button" class="btn ">{{ moneda }}</button>
              <button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="visually-hidden">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-start">
                <li *ngFor="let coin of coinsList">
                  <button class="dropdown-item" (click)="coinSelectAgente(coin.id)">{{ coin.value }}</button>
                </li>
              </ul>
              <input placeholder="  Ingrese Monto" class="form-control" formControlName="mmonto_a" type="text" (input)="formatPrima($event)">
            </div>
          </div>

        </div>

        <div class="row">
          <div class="col-sm-5">
            <h5 class="text-center"><strong>Fecha de Pago</strong></h5>
            <div>
              <input type="date" formControlName="fpago_a" class="custom-input" style="padding: 5px 5px;">
            </div>
          </div>
          <div class="col-sm-7 py-4">
            <mat-form-field class="example-full-width">
              <mat-label>Referencia</mat-label>
              <input matInput placeholder="(Últimos 6 dígitos)" maxlength="6" formControlName="xreferencia_a" type="text">
            </mat-form-field>
          </div>
        </div>

        <div class="text-end w-100">
          <button class="btn btn-primary btn-sm" (click)="guardarPagoAgente()">Aceptar</button>
        </div>

      </form>
    </mat-dialog-content>
  </ng-template> 
  
  <button matTooltip="Guardar" matTooltipPosition="left" class="btn-flotante btn-flotante-3" mat-fab style="background: #334ebd;" *ngIf="newComplementAdded" (click)="onSubmitComplement()">
    <mat-icon>save</mat-icon>
  </button>