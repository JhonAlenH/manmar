<!-- Header -->
<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8">
    <div class="container-fluid">
      <div class="header-body">
        <!-- Card stats -->
        <div class="row">
          <!-- Aquí podrías agregar tarjetas de estadísticas si lo necesitas -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Container principal -->
  <div class="container-fluid">
    <!-- Row principal -->
    <div class="row">
      <div class="col">
        <!-- Card principal -->
        <div class="card shadow hola">
          <div class="card-body">
            <!-- Formulario de filtros -->
            <form [formGroup]="administrativeForm" style="position: relative; z-index: 1000;">
              <div class="row py-3">
                <div class="col-sm-12">
                  <mat-accordion class="example-headers-align expansion_notificacion" multi>
                    <mat-expansion-panel>
                      <mat-expansion-panel-header style="background-color: #6f86e3;">
                        <mat-panel-title style="font-weight: 500; color: aliceblue;">
                          Filtros Adicionales de Búsqueda
                        </mat-panel-title>
                      </mat-expansion-panel-header>
  
                      <div class="row justify-content-center mt-3">
                        <div class="col-md-4">
                          <mat-form-field class="example-full-width">
                            <mat-label>Cedentes</mat-label>
                            <input type="text"
                                   placeholder="Seleccione Cedentes"
                                   aria-label="Seleccione"
                                   matInput
                                   [formControl]="cedentsControl"
                                   [matAutocomplete]="cedents"
                                   formControlName="xcedente"
                                   required>
                            <mat-autocomplete #cedents="matAutocomplete">
                              <mat-option *ngFor="let cedent of filteredCedents | async" [value]="cedent">
                                {{ cedent }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </div>
                        <div class="col-md-4">
                          <mat-form-field class="example-full-width">
                            <mat-label>Ramo</mat-label>
                            <input type="text"
                                   placeholder="Seleccione Ramo"
                                   aria-label="Seleccione"
                                   matInput
                                   [formControl]="tradeControl"
                                   [matAutocomplete]="trade"
                                   required>
                            <mat-autocomplete #trade="matAutocomplete" (optionSelected)="onTradeSelection($event)">
                              <mat-option *ngFor="let trade of filteredTrade | async" [value]="trade">
                                {{ trade }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </div>
                      </div>
                    </mat-expansion-panel>
                  </mat-accordion>
                </div>
              </div>
            </form>

            <mat-tab-group>
              <mat-tab label="Comisiones por Cobrar">
                <div class="d-flex py-4">
                  <div class="col-sm-12">
                    <mat-accordion>
                      <mat-expansion-panel *ngFor="let cedente of uniqueCedentes" style="background: #6f86e3;;" (opened)="onPanelOpen(cedente.ccedente, 'Todas')">
                        <mat-expansion-panel-header>
                          <mat-panel-title style="font-weight: 500; color: aliceblue;">
                            {{ cedente.xcedente }}
                          </mat-panel-title>
                        </mat-expansion-panel-header>

                        <div class="row">
                          <div class="col-md-4">
                            <mat-button-toggle-group 
                              name="fontStyle" 
                              aria-label="Font Style"
                              [value]="getDefaultToggleValue(cedente)"
                              (change)="onToggleChange($event.value, cedente)"
                            >
                              <mat-button-toggle value="bruto">Monto Bruto</mat-button-toggle>
                              <mat-button-toggle value="neto">Monto Neto</mat-button-toggle>
                            </mat-button-toggle-group>
                          </div>
                          <div class="col-md-4">
                            <div class="dropdown">
                              <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Tipo de Comisiones
                              </button>
                              <ul class="dropdown-menu">
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Vencidas')">Vencidas</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Vigentes')">Vigentes</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Próximas')">Próximas</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Todas')">Todas</a></li>
                              </ul>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="w-70">
                              <input type="text" class="form-control" placeholder="Buscar..." (input)="filterSeguimientosData($event.target.value)">
                            </div>           
                          </div>
                        </div>

                        <div class="table-responsive">

                          <table class="table table-striped custom-table">
                            <thead>
                              <tr>
                                <th>Póliza</th>
                                <th>Asegurado</th>
                                <th>Fecha Desde</th>
                                <th>Fecha Hasta</th>
                                <th>Monto Neto</th>
                                <th>Monto Neto Bs.</th>
                                <th>
                                  <input type="checkbox" [(ngModel)]="selectAll" (change)="toggleSelectAll()" />
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let item of paginatedList">
                                <td>{{ item.xpoliza }}</td>
                                <td>{{ item.xnombre }}</td>
                                <td>{{ item.fdesde_rec | date }}</td>
                                <td>{{ item.fhasta_rec | date }}</td>
                                <td>{{ item.mneto | currency }}</td>
                                <td style="padding: 0.4rem;">
                                  <input type="number" [(ngModel)]="item.mnetobs" class="custom-input">
                                </td>
                                <td>
                                  <input type="checkbox" [(ngModel)]="item.selected" (change)="onItemSelect(item)" />
                                </td>
                              </tr>
                            </tbody>
                          </table>

                          <div class="d-flex justify-content-center mt-4">
                            <ngb-pagination
                            *ngIf="receipt.length > 0"
                            [collectionSize]="receipt.length"
                            [(page)]="pageReceipt"
                            [pageSize]="pageReceiptSize"
                            [maxSize]="1"
                            [previousLabel]="'‹'"
                            [nextLabel]="'›'"
                            [boundaryLinks]="true"
                            [ellipses]="false"
                            (pageChange)="onPageChange()"
                          ></ngb-pagination>
                          </div>
                        </div>
                    
                      </mat-expansion-panel>
                    </mat-accordion>         
                  </div>

                </div>
              </mat-tab>
              <mat-tab label="Ingresar Complementos">
                <div class="d-flex py-4">
                  <div class="col-sm-12">
                    <mat-accordion>
                      <mat-expansion-panel *ngFor="let cedente of uniqueCedentesFee" style="background: #6f86e3;;" (opened)="onPanelOpen2(cedente.ccedente)">
                        <mat-expansion-panel-header>
                          <mat-panel-title style="font-weight: 500; color: aliceblue;">
                            {{ cedente.xcedente }}
                          </mat-panel-title>
                        </mat-expansion-panel-header>

                        <!-- <div class="row">
                          <div class="col-md-4">
                            <mat-button-toggle-group 
                              name="fontStyle" 
                              aria-label="Font Style"
                              [value]="getDefaultToggleValue(cedente)"
                              (change)="onToggleChange($event.value, cedente)"
                            >
                              <mat-button-toggle value="bruto">Monto Bruto</mat-button-toggle>
                              <mat-button-toggle value="neto">Monto Neto</mat-button-toggle>
                            </mat-button-toggle-group>
                          </div>
                          <div class="col-md-4">
                            <div class="dropdown">
                              <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Tipo de Comisiones
                              </button>
                              <ul class="dropdown-menu">
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Vencidas')">Vencidas</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Vigentes')">Vigentes</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Próximas')">Próximas</a></li>
                                <li><a class="dropdown-item" (click)="filterReceiptsByType('Todas')">Todas</a></li>
                              </ul>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="w-70">
                              <input type="text" class="form-control" placeholder="Buscar..." (input)="filterSeguimientosData($event.target.value)">
                            </div>           
                          </div>
                        </div>-->

                        <div class="table-responsive">

                          <table class="table table-striped custom-table">
                            <thead>
                              <tr>
                                <th>Póliza</th>
                                <th>Asegurado</th>
                                <th>Fecha Cobro</th>
                                <th>Monto Cobrado Bs.</th>
                                <th>Monto Cobrado $</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let item of paginatedFeeList">
                                <td>{{ item.xpoliza }}</td>
                                <td>{{ item.xnombre }}</td>
                                <td>{{ item.fcobro | date }}</td>
                                <td>{{ item.mingreso }} Bs</td>
                                <td>{{ item.mcomisionext | currency }}</td>
                              </tr>
                            </tbody>
                          </table>

                          <div class="d-flex justify-content-center mt-4">
                            <ngb-pagination
                            *ngIf="fee.length > 0"
                            [collectionSize]="fee.length"
                            [(page)]="pageFee"
                            [pageSize]="pageFeeSize"
                            [maxSize]="1"
                            [previousLabel]="'‹'"
                            [nextLabel]="'›'"
                            [boundaryLinks]="true"
                            [ellipses]="false"
                            (pageChange)="onPageChangeFee()"
                          ></ngb-pagination>
                          </div>
                        </div> 
                    
                      </mat-expansion-panel>
                    </mat-accordion>     
                  </div>

                </div>
              </mat-tab>
              <mat-tab label="Gestionar Distribución de Comisiones">
                <div class="d-flex py-4">
                  <div class="col-sm-12">
       
                  </div>

                </div>
              </mat-tab>
            </mat-tab-group>


          </div> 
        </div> 
      </div> 
    </div> 
  </div> 

  <button
    class="btn-flotante btn-flotante-2" 
    mat-raised-button
    style="background: #6f86e3;" 
    *ngIf="amount"
    [matMenuTriggerFor]="menu"
    >
    <div class="d-flex" style="gap: 15px;margin-top: 10px;">
      <i class= "fi fi-rs-coins" style="font-size: 20px;color: white;"></i>
      <p style="color: white;font-weight: 500;">Monto Total: {{totalMontoNeto | currency}}</p>
    </div>
    
  </button>

  <mat-menu #menu="matMenu">
    <form [formGroup]="administrativeForm" (click)="$event.stopPropagation()">
      <div class="col-sm-12">
        <mat-form-field class="example-full-width">
          <mat-label>Banco</mat-label>
          <input type="text"
                 placeholder="Seleccione Banco"
                 aria-label="Seleccione"
                 matInput
                 [formControl]="bankControl"
                 [matAutocomplete]="bank"
                 >
          <mat-autocomplete #bank="matAutocomplete" (optionSelected)="onBankSelection($event)">
            <mat-option *ngFor="let bank of filteredBank | async" 
                        [value]="bank"
                        (click)="$event.stopPropagation()">
              {{ bank }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>

      <div class="col-sm-12">
        <mat-form-field class="example-full-width">
          <mat-label>Referencia</mat-label>
          <input matInput placeholder="(Últimos 6 dígitos)" maxlength="6" formControlName="xreferencia" type="text" (change)="validateCobro()">
        </mat-form-field>
      </div>

      <div class="d-flex justify-content-center">
        <button
        mat-raised-button
        style="background: #6f86e3;" 
        (click)="validateCobro()"
        >
        <div class="d-flex" style="gap: 15px;margin-top: 10px;">
          <i class= "fi fi-ss-deposit-alt" style="font-size: 20px;color: white;"></i>
          <p style="color: white;font-weight: 500;">Aceptar</p>
        </div>
        
      </button>
      </div>

    </form>
  </mat-menu>